{% if mysql is not defined %}
  {% error "mysql configuration is required" %}
{% endif %}
{% for required_var in ['database', 'username', 'password', 'host', 'port'] %}
  {% if mysql[required_var] is not defined %}
    {% error "mysql." + required_var + " is required" %}
  {% endif %}
{% endfor %}
{
  "Dhcp4": {
    "server-tag": "TAG",
    "config-control": {
        "config-databases": [
          {
            "type":     "mysql",
            "name":     "{{ mysql.database }}",
            "user":     "{{ mysql.username }}",
            "password": "{{ mysql.password }}",
            "host":     "{{ mysql.host     }}",
            "port":     {{ mysql.port }}
          }
        ],
        "config-fetch-wait-time": 20
    },
    "hosts-database": {
      "type":                "mysql",
      "reconnect-wait-time": 3000, // expressed in ms
      "max-reconnect-tries": 999,
      "on-fail":             "serve-retry-continue",
      "name":                "{{ mysql.database }}",
      "user":                "{{ mysql.username }}",
      "password":            "{{ mysql.password }}",
      "host":                "{{ mysql.host     }}",
      "port":                {{ mysql.port }}
    },
    "lease-database": {
      "type":                "mysql",
      "reconnect-wait-time": 3000, // expressed in ms
      "max-reconnect-tries": 999,
      "on-fail":             "serve-retry-continue",
      "name":                "{{ mysql.database }}",
      "user":                "{{ mysql.username }}",
      "password":            "{{ mysql.password }}",
      "host":                "{{ mysql.host     }}",
      "port":                {{ mysql.port }}
    },
    "interfaces-config": {
{% if interfaces is not defined or interfaces|length == 0 %}
  {% error "interfaces list is required and cannot be empty" %}
{% endif %}
      "interfaces": [ {{ interfaces | join(',') }} ]
    },
    "control-socket": {
        "socket-type": "unix",
        "socket-name": "/run/kea/kea4-ctrl-socket"
    },
    "hooks-libraries": [
      {
        "library": "/usr/lib/kea/hooks/libdhcp_mysql_cb.so"
      }
    ]
  }
}
