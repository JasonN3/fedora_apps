mode server
port {{ openvpn.port }}
proto {{ openvpn.protocol }}
dev tun

ca /etc/openvpn/ca.pem
cert /etc/openvpn/cert.pem
key /etc/openvpn/cert.key
dh /etc/openvpn/dhparams.pem

topology subnet
{% if openvpn.subnet4 is defined %}
server {{ openvpn.subnet4 }}
{% endif %}
{% if openvpn.subnet6 is defined %}
server-ipv6 {{ openvpn.subnet6 }}
{% endif %}

ifconfig-pool-persist /run/openvpn/ipp.txt

username-as-common-name
script-security 2
{% if openvpn.dccd is defined %}
client-connect {{ openvpn.dccd }}
{% endif %}
{% if openvpn.learncmd is defined %}
learn-address {{ openvpn.learncmd }}
{% endif %}

{% if openvpn.push is defined %}
{% for rule in openvpn.push %}
push "{{ rule }}"
{% endfor %}
{% endif %}

duplicate-cn
keepalive 10 120

explicit-exit-notify 1

# oauth
management /run/openvpn/server.sock unix /etc/openvpn/mgmt.txt
management-client-auth
auth-user-pass-optional
auth-gen-token {{ oauth.token_ttl }} external-auth
